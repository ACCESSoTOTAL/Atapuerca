<!DOCTYPE html>
<html>
<head>
    <title>Debug Retos</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .error { color: #f44; }
        .success { color: #0f0; }
        .warning { color: #fa0; }
        .info { color: #09f; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico de Retos.html</h1>
    <div id="output"></div>

    <script>
        function log(mensaje, clase = 'info') {
            const div = document.createElement('div');
            div.className = clase;
            div.innerHTML = mensaje;
            document.getElementById('output').appendChild(div);
        }

        // Funci√≥n de diagn√≥stico
        async function diagnosticar() {
            log('üöÄ Iniciando diagn√≥stico...', 'info');
            
            // 1. Verificar si se cargan las funciones
            log('\nüìã VERIFICANDO FUNCIONES DISPONIBLES:', 'info');
            
            const funciones = [
                'cargarRetos',
                'desbloquearTodosLosRetos', 
                'modoDesarrollador',
                'irAlReto',
                'mostrarPistaSimple',
                'cargarEjemplo'
            ];
            
            funciones.forEach(func => {
                if (typeof window[func] === 'function') {
                    log(`‚úÖ ${func}: disponible`, 'success');
                } else {
                    log(`‚ùå ${func}: NO disponible`, 'error');
                }
            });
            
            // 2. Verificar API
            log('\nüåê VERIFICANDO API:', 'info');
            try {
                const response = await fetch('https://atapuerca-net.es/api/retos.php?action=list');
                const data = await response.json();
                
                if (data.success && data.data) {
                    log(`‚úÖ API: ${data.data.length} retos disponibles`, 'success');
                } else {
                    log(`‚ùå API: ${data.error || 'Error desconocido'}`, 'error');
                }
            } catch (error) {
                log(`‚ùå API: Error de conexi√≥n - ${error.message}`, 'error');
            }
            
            // 3. Verificar variables globales
            log('\nüîß VERIFICANDO VARIABLES GLOBALES:', 'info');
            
            if (typeof RetosDB !== 'undefined') {
                log('‚úÖ RetosDB: disponible', 'success');
                log(`üìä Cache: ${RetosDB.loaded() ? 'cargado' : 'no cargado'}`, RetosDB.loaded() ? 'success' : 'warning');
            } else {
                log('‚ùå RetosDB: NO disponible', 'error');
            }
            
            // 4. Verificar DOM
            log('\nüìÑ VERIFICANDO ELEMENTOS DOM:', 'info');
            const elementos = ['retos-container'];
            elementos.forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    log(`‚úÖ #${id}: encontrado`, 'success');
                } else {
                    log(`‚ùå #${id}: NO encontrado`, 'error');
                }
            });
            
            // 5. Verificar errores de consola
            log('\nüö® CAPTURANDO ERRORES:', 'info');
            
            window.addEventListener('error', function(e) {
                log(`‚ùå Error JS: ${e.message} en ${e.filename}:${e.lineno}`, 'error');
            });
            
            // 6. Intentar cargar retos manualmente
            log('\nüîÑ INTENTANDO CARGAR RETOS MANUALMENTE:', 'info');
            try {
                if (typeof cargarRetos === 'function') {
                    await cargarRetos();
                    log('‚úÖ cargarRetos() ejecutada exitosamente', 'success');
                } else {
                    log('‚ùå Funci√≥n cargarRetos no disponible', 'error');
                }
            } catch (error) {
                log(`‚ùå Error ejecutando cargarRetos: ${error.message}`, 'error');
            }
            
            log('\nüèÅ Diagn√≥stico completado', 'info');
        }
        
        // Ejecutar diagn√≥stico cuando cargue la p√°gina
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', diagnosticar);
        } else {
            diagnosticar();
        }
    </script>
    
    <!-- Cargar los mismos scripts que retos.html -->
    <script src="js/dataLoader.js"></script>
    <script src="js/retos-db-simple.js"></script>
</body>
</html>
