<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retos SQL - Atapuerca Net</title>
  <link rel="stylesheet" href="css/estilos.css" />
</head>
<body>
  <header>
    <div style="display: flex; align-items: center; justify-content: center; gap: 1em; flex-wrap: wrap;">
      <img src="docs/logo-atapuerca.png" alt="Logo Atapuerca" style="height: 100px; filter: drop-shadow(0 0 10px var(--primary-green));">
      <h1 class="glow">‚öîÔ∏è RETOS SQL</h1>
    </div>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="retos.html">Retos</a>
      <a href="sql.html">Terminal SQL</a>
      <a href="descargas.html">Descargas</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </header>
  <main>
    <h2>üéØ Entrenamientos de la resistencia</h2>
    <p>Completa estos desaf√≠os SQL para entrenar tus habilidades y ganar puntos. Cada reto te acerca m√°s a convertirte en un maestro hacker de datos.</p>
    
    <div id="retos-container">
      <!-- Los retos se cargar√°n aqu√≠ din√°micamente -->
    </div>
    
    <div style="margin-top: 3em; padding: 1.5em; background: var(--bg-light); border-radius: 5px; border-left: 4px solid var(--accent-cyan);">
      <h4 style="margin: 0 0 1em 0; color: var(--accent-cyan);">ÔøΩ Instrucciones:</h4>
      <ol style="margin: 0; padding-left: 1.5em; color: var(--text-secondary);">
        <li>Lee la descripci√≥n del reto</li>
        <li>Si necesitas ayuda, haz clic en "üí° Pista"</li>
        <li>Haz clic en "üöÄ Ir al Terminal" para escribir tu consulta</li>
        <li>El sistema detectar√° autom√°ticamente si has completado el reto</li>
        <li>¬°Gana puntos y desbloquea nuevos desaf√≠os!</li>
      </ol>
    </div>
    
    <!-- Botones de Administraci√≥n -->
    <div style="margin-top: 2em; padding: 1.5em; background: var(--bg-medium); border-radius: 5px; border-left: 4px solid var(--accent-orange); text-align: center;">
      <h4 style="margin: 0 0 1em 0; color: var(--accent-orange);">‚öôÔ∏è Administraci√≥n:</h4>
      
      <div style="display: flex; gap: 1em; justify-content: center; flex-wrap: wrap; margin-bottom: 1em;">
        <!-- Bot√≥n Desbloquear Todos -->
        <button 
          onclick="desbloquearTodosLosRetos()" 
          style="
            background: linear-gradient(135deg, #00dd00, #00aa00); 
            color: white; 
            border: none; 
            padding: 0.8em 1.5em; 
            border-radius: 5px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 0.9em;
            transition: all 0.3s ease;
          "
          onmouseover="this.style.transform='scale(1.05)'" 
          onmouseout="this.style.transform='scale(1)'"
        >
          üîì Desbloquear Todos los Retos
        </button>

        <!-- Bot√≥n Modo Desarrollador -->
        <button 
          onclick="modoDesarrollador()" 
          id="btnModoDesarrollador"
          style="
            background: linear-gradient(135deg, #4169E1, #1E90FF); 
            color: white; 
            border: none; 
            padding: 0.8em 1.5em; 
            border-radius: 5px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 0.9em;
            transition: all 0.3s ease;
          "
          onmouseover="this.style.transform='scale(1.05)'" 
          onmouseout="this.style.transform='scale(1)'"
        >
          üõ†Ô∏è Modo Desarrollador
        </button>

        <!-- Bot√≥n Reset -->
        <button 
          onclick="resetearProgreso()" 
          style="
            background: linear-gradient(135deg, #ff4444, #cc3333); 
            color: white; 
            border: none; 
            padding: 0.8em 1.5em; 
            border-radius: 5px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 0.9em;
            transition: all 0.3s ease;
          "
          onmouseover="this.style.transform='scale(1.05)'" 
          onmouseout="this.style.transform='scale(1)'"
        >
          üîÑ Resetear Progreso
        </button>
      </div>

      <!-- Descripciones de las opciones -->
      <div style="text-align: left; color: var(--text-secondary); font-size: 0.85em; line-height: 1.4;">
        <div style="margin-bottom: 0.5em;">
          <strong style="color: #00dd00;">üîì Desbloquear Todos:</strong> Marca todos los retos como completados y otorga puntos m√°ximos
        </div>
        <div style="margin-bottom: 0.5em;">
          <strong style="color: #4169E1;">üõ†Ô∏è Modo Desarrollador:</strong> Accede a todos los retos sin afectar tu progreso real
        </div>
        <div>
          <strong style="color: #ff4444;">üîÑ Resetear Progreso:</strong> Elimina completamente todos los retos completados y puntos
        </div>
      </div>
    </div>
  </main>
  <footer>
    <p>&copy; 2025 Atapuerca Net</p>
  </footer>
  <script src="js/dataLoader.js"></script>
  <script src="js/retos.js"></script>
  <script>
    // Cargar retos al abrir la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM cargado, intentando cargar retos...');
      
      // Verificar que las funciones existen
      if (typeof cargarRetos === 'function') {
        console.log('Funci√≥n cargarRetos encontrada, ejecutando...');
        try {
          cargarRetos();
        } catch (error) {
          console.error('Error al cargar retos:', error);
          // Mostrar mensaje de error si falla
          const container = document.getElementById('retos-container');
          if (container) {
            container.innerHTML = '<p style="color: var(--accent-orange);">‚ö†Ô∏è Error cargando retos. Por favor, recarga la p√°gina.</p>';
          }
        }
      } else {
        console.log('Funci√≥n cargarRetos no encontrada');
        const container = document.getElementById('retos-container');
        if (container) {
          container.innerHTML = '<p style="color: var(--accent-orange);">‚ö†Ô∏è Sistema de retos no disponible. Por favor, recarga la p√°gina.</p>';
        }
      }
    });
      function resetearProgreso() {
        // Confirmar la acci√≥n con el usuario
        const confirmacion = confirm(
          '‚ö†Ô∏è ¬øEST√ÅS SEGURO?\n\n' +
          'Esto eliminar√°:\n' +
          '‚Ä¢ Todos los retos completados\n' +
          '‚Ä¢ Puntuaci√≥n total acumulada\n' +
          '‚Ä¢ Progreso de fases\n' +
          '‚Ä¢ Datos guardados localmente\n\n' +
          '¬øQuieres continuar y resetear todo el progreso?'
        );
        
        if (confirmacion) {
          // Doble confirmaci√≥n para estar seguro
          const confirmarFinal = confirm(
            'üîÑ √öLTIMA CONFIRMACI√ìN\n\n' +
            'Se va a borrar TODO tu progreso.\n' +
            'Esta acci√≥n NO se puede deshacer.\n\n' +
            '¬øProceder con el reset completo?'
          );
          
          if (confirmarFinal) {
            ejecutarReset();
          }
        }
      }
      
      function ejecutarReset() {
        try {
          // Limpiar localStorage completamente
          localStorage.removeItem('retosCompletados');
          localStorage.removeItem('retoActual');
          localStorage.removeItem('puntuacionAtapuerca');
          localStorage.removeItem('progresoAtapuerca');
          localStorage.removeItem('consultaPendiente');
          localStorage.removeItem('queryToLoad');
          localStorage.removeItem('retoActualObj');
          
          // Limpiar cualquier dato adicional que pueda existir
          const keysToRemove = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && (key.includes('atapuerca') || key.includes('reto') || key.includes('sql'))) {
              keysToRemove.push(key);
            }
          }
          keysToRemove.forEach(key => localStorage.removeItem(key));
          
          // Resetear variables globales si existen
          if (typeof retosCompletados !== 'undefined') {
            retosCompletados.length = 0;
          }
          if (typeof retoActual !== 'undefined') {
            retoActual = 1;
          }
          if (typeof puntosTotal !== 'undefined') {
            puntosTotal = 0;
          }
          
          // Mostrar mensaje de √©xito
          alert(
            '‚úÖ RESET COMPLETADO\n\n' +
            'üîÑ Todo el progreso ha sido eliminado\n' +
            'üéØ Puedes empezar desde el Reto 1\n' +
            'üíæ Cache local limpiado\n\n' +
            'La p√°gina se recargar√° autom√°ticamente...'
          );
          
          // Recargar la p√°gina para reflejar los cambios
          setTimeout(() => {
            window.location.reload();
          }, 1000);
          
        } catch (error) {
          console.error('Error durante el reset:', error);
          alert('‚ùå Error durante el reset. Intenta recargar la p√°gina manualmente.');
        }
      }

      function obtenerReto(id) {
        // Buscar en todos los niveles
        for (let nivel in retos) {
          const reto = retos[nivel].find(r => r.id === id);
          if (reto) return reto;
        }
        return null;
      }

      function cargarEjemplo(idReto) {
        const reto = obtenerReto(idReto);
        if (reto && reto.ejemploQuery) {
          localStorage.setItem('queryToLoad', reto.ejemploQuery);
          window.location.href = 'freetds-final.html';
        } else {
          alert('No hay ejemplo disponible para este reto.');
        }
      }

      function mostrarPistaSimple(idReto) {
        const pistaDiv = document.getElementById('pista-' + idReto);
        if (pistaDiv) {
          pistaDiv.style.display = pistaDiv.style.display === 'none' ? 'block' : 'none';
        }
      }
    
      function irAlReto(numeroReto) {
        // Ir al terminal SIN cargar la consulta - que sea un verdadero desaf√≠o
        const reto = retos && retos.find(r => r.id === numeroReto);
        if (reto) {
          localStorage.setItem('retoActual', JSON.stringify(reto));
          // NO guardamos la consulta sugerida - el usuario debe resolverlo
          localStorage.removeItem('consultaPendiente'); 
          window.location.href = 'sql.html?reto=true';
        }
      }

      // Actualizar interfaz seg√∫n el modo desarrollador
      function actualizarInterfazModoDesarrollador() {
        const modoDesarrollador = localStorage.getItem('modoDesarrollador') === 'true';
        const btnModoDesarrollador = document.getElementById('btnModoDesarrollador');
        
        if (modoDesarrollador) {
          btnModoDesarrollador.style.background = 'linear-gradient(135deg, #ff6b35, #f7931e)';
          btnModoDesarrollador.innerHTML = 'üü† Desactivar Modo Dev';
          
          // Agregar un indicador visual en la parte superior
          if (!document.getElementById('indicadorModoDesarrollador')) {
            const indicador = document.createElement('div');
            indicador.id = 'indicadorModoDesarrollador';
            indicador.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              background: linear-gradient(135deg, #ff6b35, #f7931e);
              color: white;
              text-align: center;
              padding: 0.5em;
              font-weight: bold;
              z-index: 1000;
              box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            indicador.innerHTML = 'üõ†Ô∏è MODO DESARROLLADOR ACTIVO - Todos los retos desbloqueados para testing';
            document.body.insertBefore(indicador, document.body.firstChild);
            
            // Ajustar el margen del header para compensar
            document.querySelector('header').style.marginTop = '3em';
          }
        } else {
          btnModoDesarrollador.style.background = 'linear-gradient(135deg, #4169E1, #1E90FF)';
          btnModoDesarrollador.innerHTML = 'üõ†Ô∏è Modo Desarrollador';
          
          // Remover indicador si existe
          const indicador = document.getElementById('indicadorModoDesarrollador');
          if (indicador) {
            indicador.remove();
            document.querySelector('header').style.marginTop = '0';
          }
        }
      }

      // Ejecutar al cargar la p√°gina
      document.addEventListener('DOMContentLoaded', function() {
        actualizarInterfazModoDesarrollador();
      });
  </script>
</body>
</html>