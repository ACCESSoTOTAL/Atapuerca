<!DOCTYPE html>
<html>
<head>
    <title>Test Simple API</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .error { color: #f44; }
        .success { color: #0f0; }
        .warning { color: #fa0; }
        .info { color: #09f; }
        button { padding: 10px 20px; margin: 10px; background: #333; color: #fff; border: 1px solid #666; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîß Test Simple de API</h1>
    <div id="output"></div>
    
    <button onclick="testAPI()">üîó Test API</button>
    <button onclick="testFunciones()">‚öôÔ∏è Test Funciones</button>
    <button onclick="testDOM()">üìÑ Test DOM</button>

    <script>
        function log(mensaje, clase = 'info') {
            const div = document.createElement('div');
            div.className = clase;
            div.innerHTML = mensaje;
            document.getElementById('output').appendChild(div);
        }

        async function testAPI() {
            log('üåê Probando API directamente...', 'info');
            
            try {
                const response = await fetch('https://atapuerca-net.es/api/retos.php?action=list');
                log('üì° Response status: ' + response.status, response.ok ? 'success' : 'error');
                
                const text = await response.text();
                log('üìã Response text (primeros 200 chars): ' + text.substring(0, 200), 'info');
                
                try {
                    const data = JSON.parse(text);
                    log('‚úÖ JSON v√°lido:', 'success');
                    log('üî¢ Success: ' + data.success, data.success ? 'success' : 'error');
                    if (data.data) {
                        log('üìä Retos encontrados: ' + data.data.length, 'success');
                    }
                    if (data.error) {
                        log('‚ùå Error: ' + data.error, 'error');
                    }
                } catch (jsonError) {
                    log('‚ùå Error parseando JSON: ' + jsonError.message, 'error');
                }
                
            } catch (fetchError) {
                log('‚ùå Error en fetch: ' + fetchError.message, 'error');
            }
        }

        function testFunciones() {
            log('‚öôÔ∏è Probando funciones...', 'info');
            
            const funciones = [
                'cargarRetos',
                'desbloquearTodosLosRetos', 
                'modoDesarrollador',
                'irAlReto',
                'mostrarPistaSimple',
                'cargarEjemplo'
            ];
            
            funciones.forEach(function(func) {
                if (typeof window[func] === 'function') {
                    log('‚úÖ ' + func + ': disponible', 'success');
                } else {
                    log('‚ùå ' + func + ': NO disponible (tipo: ' + typeof window[func] + ')', 'error');
                }
            });
        }

        function testDOM() {
            log('üìÑ Probando elementos DOM...', 'info');
            
            const elementos = ['retos-container'];
            elementos.forEach(function(id) {
                const elem = document.getElementById(id);
                if (elem) {
                    log('‚úÖ #' + id + ': encontrado', 'success');
                } else {
                    log('‚ùå #' + id + ': NO encontrado', 'error');
                }
            });
        }

        // Crear elemento DOM de prueba
        window.addEventListener('DOMContentLoaded', function() {
            const testContainer = document.createElement('div');
            testContainer.id = 'retos-container';
            testContainer.style.display = 'none';
            document.body.appendChild(testContainer);
            
            log('üöÄ P√°gina cargada. Puedes hacer las pruebas.', 'info');
        });

        // Capturar errores
        window.addEventListener('error', function(e) {
            log('‚ùå Error JS: ' + e.message + ' en l√≠nea ' + e.lineno, 'error');
        });
    </script>
    
    <!-- Scripts de retos -->
    <script src="js/dataLoader.js"></script>
    <script src="js/retos-db-simple.js"></script>
</body>
</html>
